<!doctype html>

<head>
  <script src="blanket.min.js"></script>
  <script src="../build/jtmpl.js" data-cover></script>
  <script src="tinytest.js"></script>
  <style>
    .some-class {
      color:red;
      -webkit-transition:color 0.5s ease-in;  
      -moz-transition:color 0.5s ease-in;  
      -o-transition:color 0.5s ease-in;  
      transition:color 0.5s ease-in;
    }

    h4 {
      margin-top: 4em;
    }
  </style>
</head>


<body>

  <div style="margin:4px; padding:1em; background:#fff; min-height:100%; box-sizing:border-box">

    <div id="target" data-jtmpl="#app"></div>

    <div id="target2" data-jtmpl="#target2" data-model="external-model.js">
      <h3>Another target, self-contained template, external model</h3>
      {{#items}}{{.}}&nbsp;{{/}}
    </div>

  </div>














  <script id="app" data-model="#model" type="text/jtmpl">
    <h3><code>var model = jtmpl('#target');</code></h3>


    <h4><code>model('variable')</code></h4>
    <input value="{{variable}}" {{! multiline
      mustache
      comment }}/> = <span id="variable">{{variable}}</span>


    <h4><code>model('innerHTML')</code></h4>
    <div>
      {{{innerHTML}}}
    </div>


    <h4><code>model('numbers')</code></h4>
    <ul>
    {{#numbers}}
      <li>{{.}}</li>
    {{/numbers}}
    {{^numbers}}
      <li>&lt;no numbers&gt;</li>
    {{/numbers}}
    </ul>


    <h4><code>model('table')</code></h4>
    <table>
      <tbody>
        {{#table}}
        <tr>
          {{#.}}<td>{{.}}</td>{{/}}
        </tr>
        {{/table}}
      </tbody>
    </table>


    <h4><code>model('options')</code></h4>
    <p>
      <select>
        {{#options}}
        <option selected={{checked}}>{{text}}</option>
        {{/options}}
      </select>
    </p>


    <h4><code>model('options')</code></h4>
    <p>
      {{#options}}
      <label><input type="radio" name="radio-group" checked={{checked}}>{{text}}</label>
      {{/options}}
    </p>


    <h4><code>model('condition')</code></h4>
    <p>
      <label>
        <input type="checkbox" checked="{{condition}}">
        <code>model('condition')</code>
      </label>
    </p>
    <p class="{{#condition}}some-class{{/}}">Lorem ipsum ...</p>
    {{#condition}}
      <p>The above paragraph has .some-class</p>
    {{/condition}}
    {{^condition}}
      <p>Inverted section</p>
    {{/}}


    <h4><code>model('tree')</code></h4>
    <div>{{>"#tree-template"}}</div>
    

    <h4><code>model('externalPartial')</code></h4>
    <div>
    {{#externalPartial}}
      {{"partials.html#a-partial"}}
    {{/}}
    </div>
  </script>


  <script id="tree-template" type="text/jtmpl">
    <ul>
      {{#tree}}
      <li>
        {{value}} 
        <div>{{>"#tree-template"}}</div>
      </li>
      {{/tree}}
    </ul>
  </script>


  <script id="model">
    if (typeof module !== 'undefined') module.exports = {

      // Plugins
      __init__: function() {
        this('initialized', true);
      },

      // Fields
      variable: 42,
      innerHTML: 'Try <code>jtmpl("#target")("innerHTML", "&lt;p&gt;new content&lt;/p&gt;")</code> on the console to replace me.',
      condition: true,
      numbers: [1, 2, 3],
      table: [
        [1, 2, 3],
        [4, 5, 6],
        [7, 8, 9]
      ],
      options: [
        { checked: true, text: 'one' },
        { checked: false, text: 'two' },
        { checked: false, text: 'three' }
      ],
      tree: [
        {
          value: 1,
          tree: [
            {
              value: 2,
              tree: [
                {
                  value: 3
                },
                {
                  value: 4
                }
              ]
            },
            {
              value: 5
            }
          ]
        },
        {
          value: 6
        }
      ],
      externalPartial: {
        extended: 'extended property'
      }
    }
  </script>


  <script>
    document.addEventListener('DOMContentLoaded', function go() {

      setTimeout(function() {

        tests({

          'jtmpl is a function': function() {
            assert(typeof jtmpl === 'function');
          },

          'it processes #target[data-jtmpl] elements': function() {
            assert(document.getElementById('target').childNodes.length > 0);
          },

          '__init__ plugin is executed': function() {
            assert(jtmpl('#target')('initialized'));
          },

          'jtmpl("#target") returns wrapped model': function() {
            assert(Array.isArray(jtmpl('#target')('numbers').values));
          },

          'it renders <input value="{{variable}}">': function() {
            assert(document.querySelector('input').value === "42");
          },

          'it renders {{variable}}': function() {
            assert(document.querySelector('#variable').innerHTML === "42");
          },

          'it renders {{#numbers}}': function() {
            assert(
              [].map.call(
                document.querySelector('ul').querySelectorAll('li'),
                function(el) {
                  return el.innerHTML;
                }
              ).reduce(function(a,b) {
                return a + ', ' + b;
              }) === '1, 2, 3'
            );
          },

          'it renders {{#table}}': function() {
            assert(
              [].map.call(
                document.querySelector('table').querySelectorAll('td'),
                function(el) {
                  return el.innerHTML;
                }
              ).reduce(function(a,b) {
                return a + ', ' + b;
              }) === "1, 2, 3, 4, 5, 6, 7, 8, 9"
            );
          },

          'it renders class="{{#condition}}some-class{{/}}"': function() {
            assert(document.querySelectorAll('.some-class').length === 1);
          }

        });

      }, 0);

      document.removeEventListener('DOMContentLoaded', go);

    });
  </script>

</body>