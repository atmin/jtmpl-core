<!doctype html>

<div style="margin:4px; padding:1em; background:#fff; min-height:100%; box-sizing:border-box">

  <div id="target" data-jtmpl="#app"></div>

</div>
















<style>
  .some-class {
    color:red;
    -webkit-transition:color 0.5s ease-in;  
    -moz-transition:color 0.5s ease-in;  
    -o-transition:color 0.5s ease-in;  
    transition:color 0.5s ease-in;
  }
</style>


<script id="app" data-model="#model" type="text/jtmpl">
  <h3><code>var model = jtmpl('#target');</code></h3>
  <h5><code>model('variable')</code></h5>
  <input value="{{variable}}"/> = {{variable}}

  <h5><code>model('numbers')</code></h5>
  <ul>
  {{#numbers}}
    <li>{{.}}</li>
  {{/numbers}}
  </ul>

  <h5><code>model('table')</code></h5>
  {{#table}}
  <table>
    <tbody>
      {{#.}}
      <tr>
        {{#.}}<td>{{.}}</td>{{/}}
      </tr>
      {{/}}
    </tbody>
  </table>
  {{/table}}

  <h5><code>model('options')</code></h5>
  <p>
    <select>
      {{#options}}
      <option selected={{checked}}>{{text}}</option>
      {{/options}}
    </select>
  </p>

  <h5><code>model('options')</code></h5>
  <p>
    {{#options}}
    <label><input type="radio" name="radio-group" checked={{checked}}>{{text}}</label>
    {{/options}}
  </p>

  <h5><code>model('condition')</code></h5>
  <p>
    <label>
      <input type="checkbox" checked="{{condition}}">
      <code>model('condition')</code>
    </label>
  </p>
  <p class="{{#condition}}some-class{{/}}">Lorem ipsum ...</p>
  {{#condition}}
    <p>The above paragraph has .some-class</p>
  {{/condition}}

  <h5><code>model('tree')</code></h5>
  <ul>
    {{#tree}}
    <li>
      {{value}} 
      <div>{{>"#tree-template"}}</div>
    </li>
    {{/tree}}
  </ul>
</script>


<script id="tree-template" type="text/jtmpl">
  <ul>
    {{#tree}}
    <li>
      {{value}} 
      <div>{{>"#tree-template"}}</div>
    </li>
    {{/tree}}
  </ul>
</script>


<script id="model" type="text/jtmpl">
  {
    variable: 42,
    condition: true,
    numbers: [1, 2, 3],
    table: [
      [1, 2, 3],
      [4, 5, 6],
      [7, 8, 9]
    ],
    options: [
      { checked: true, text: 'one' },
      { checked: false, text: 'two' },
      { checked: false, text: 'three' }
    ],
    tree: [
      {
        value: 1,
        tree: [
          {
            value: 2,
            tree: [
              {
                value: 3
              },
              {
                value: 4
              }
            ]
          },
          {
            value: 5
          }
        ]
      },
      {
        value: 6
      }
    ]
  }
</script>

<script src="../build/jtmpl.js"></script>
<script src="tinytest.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function go() {

    setTimeout(function() {

      tests({

        'jtmpl is a function': function() {
          assert(typeof jtmpl === 'function');
        },

        'it processes #target[data-jtmpl] elements': function() {
          assert(document.getElementById('target').childNodes.length > 0);
        },

        'jtmpl("#target") returns wrapped model': function() {
          assert(Array.isArray(jtmpl('#target')('numbers').values));
        },

        'it renders <ul> with 3 numbers': function() {
          assert(
            [].map.call(
              document.querySelector('ul').querySelectorAll('li'),
              function(el) {
                return el.innerHTML;
              }
            ).reduce(function(a,b) {
              return a + ', ' + b;
            }) === '1, 2, 3'
          );
        }

      });

    }, 0);

    document.removeEventListener('DOMContentLoaded', go);

  });
</script>
